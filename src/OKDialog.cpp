//
//  Copyright (c) 2023, Alexander Hude
//  All rights reserved.
//

#include "Inkplate.h"
#include "Fonts/FreeSansBold18pt7b.h"
#include "Fonts/FreeSansBold12pt7b.h"

#include "EventManagerDelegate.hpp"
#include "OKDialog.hpp"

#include "helper.hpp"

const unsigned char OKDialog::s_okIcon [] PROGMEM = {
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x30, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x10, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x10, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x00, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x00, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x10, 0xff, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x00, 0x10, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x00, 0x30, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x00, 0x70, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xfe, 0x00, 0x01, 0xf0, 
	0xff, 0xff, 0xff, 0xff, 0xfc, 0x00, 0x03, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xf8, 0x00, 0x07, 0xf0, 
	0xf9, 0xff, 0xff, 0xff, 0xf0, 0x00, 0x0f, 0xf0, 0xc0, 0x7f, 0xff, 0xff, 0xe0, 0x00, 0x1f, 0xf0, 
	0x80, 0x3f, 0xff, 0xff, 0xc0, 0x00, 0x3f, 0xf0, 0x80, 0x1f, 0xff, 0xff, 0x80, 0x00, 0x7f, 0xf0, 
	0x00, 0x0f, 0xff, 0xff, 0x00, 0x00, 0xff, 0xf0, 0x00, 0x07, 0xff, 0xfe, 0x00, 0x01, 0xff, 0xf0, 
	0x00, 0x03, 0xff, 0xfc, 0x00, 0x03, 0xff, 0xf0, 0x00, 0x01, 0xff, 0xf8, 0x00, 0x07, 0xff, 0xf0, 
	0x80, 0x00, 0xff, 0xf0, 0x00, 0x0f, 0xff, 0xf0, 0x80, 0x00, 0x7f, 0xe0, 0x00, 0x1f, 0xff, 0xf0, 
	0xc0, 0x00, 0x3f, 0xc0, 0x00, 0x3f, 0xff, 0xf0, 0xe0, 0x00, 0x1f, 0x80, 0x00, 0x7f, 0xff, 0xf0, 
	0xf0, 0x00, 0x0f, 0x00, 0x00, 0xff, 0xff, 0xf0, 0xf8, 0x00, 0x06, 0x00, 0x01, 0xff, 0xff, 0xf0, 
	0xfc, 0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xf0, 0xfe, 0x00, 0x00, 0x00, 0x07, 0xff, 0xff, 0xf0, 
	0xff, 0x00, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xf0, 0xff, 0x80, 0x00, 0x00, 0x1f, 0xff, 0xff, 0xf0, 
	0xff, 0xc0, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xf0, 0xff, 0xe0, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xf0, 
	0xff, 0xf0, 0x00, 0x00, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xf8, 0x00, 0x01, 0xff, 0xff, 0xff, 0xf0, 
	0xff, 0xfc, 0x00, 0x03, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xfe, 0x00, 0x07, 0xff, 0xff, 0xff, 0xf0, 
	0xff, 0xff, 0x00, 0x0f, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0x80, 0x1f, 0xff, 0xff, 0xff, 0xf0, 
	0xff, 0xff, 0xc0, 0x3f, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xf0, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf0
};

void OKDialog::clearBackground(Inkplate* context) {
	context->fillRect(m_headerSplit.getXpos(), m_headerSplit.getYpos(), s_width, s_height, WHITE);
}

void OKDialog::setHeaderText(const char* text) {
	m_headerText.setText(text);
}

void OKDialog::setInfoText(const char* text) {
	m_infoText.setText(text);
}

void OKDialog::setActions(ActionHandler okAction) {
	m_ok.setAction(okAction);
}

void OKDialog::create(int width, int height) {
    m_headerSplit.setXYpos((width - s_width)/2, (height - s_height)/2);
    m_headerSplit.setArea(s_width, s_height);
    m_headerSplit.setOffset(80);

    int dlgXpos = m_headerSplit.getXpos();
    int dlgYpos = m_headerSplit.getYpos();

    m_headerText.setXYpos(dlgXpos+30, dlgYpos+60);
    m_headerText.setFont(&FreeSansBold18pt7b);

	m_infoText.setXYpos(dlgXpos+30, dlgYpos + m_headerSplit.getTopHeight() + 40);
	m_infoText.setWidth(s_width - 60);
	m_infoText.setFont(&FreeSansBold12pt7b);
	m_infoText.setTextAlignment(TextAlignment::Center);

    dlgXpos = m_headerSplit.getXpos() + 30;
    dlgYpos = m_headerSplit.getYpos() + m_headerSplit.getTopHeight() + 60;

    m_ok.setXYpos(dlgXpos, dlgYpos);
	m_ok.setWidth(s_width - 60);
	m_ok.setText("OK");
	m_ok.setTextOffset(150);
}

bool OKDialog::render(Inkplate* context) {
    int dlgXpos = m_headerSplit.getXpos();
    int dlgYpos = m_headerSplit.getYpos();

	context->drawRect(dlgXpos+1, dlgYpos+1, s_width-2, s_height-2, BLACK);
    context->drawThickLine(dlgXpos + 5, dlgYpos + s_height, dlgXpos + 2 + s_width, dlgYpos + s_height, BLACK, 4);
    context->drawThickLine(dlgXpos + s_width, dlgYpos + 5, dlgXpos + s_width, dlgYpos + 2 + s_height, BLACK, 4);

    m_headerSplit.render(context);
	m_infoText.render(context);
    m_headerText.render(context);

    m_ok.render(context);

    return false;
}

bool OKDialog::touch(Inkplate* context) {
    bool res = false;
    res |= m_ok.touch(context);
    return res;
}
